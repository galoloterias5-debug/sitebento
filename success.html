<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bento • Sucesso</title>

  <link rel="dns-prefetch" href="//cdn.discordapp.com">
  <link rel="preconnect" href="https://cdn.discordapp.com" crossorigin>

  <link rel="stylesheet" href="./styles.css" />
  <style>
    .trackGrid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media(max-width:900px){.trackGrid{grid-template-columns:1fr}}
    .step{border:1px solid var(--border);background:rgba(255,255,255,.02);border-radius:14px;padding:12px}
    .stepTitle{display:flex;justify-content:space-between;gap:10px;align-items:center}
    .dot{width:10px;height:10px;border-radius:999px;background:rgba(255,255,255,.18);display:inline-block}
    .dotActive{background:linear-gradient(135deg, var(--brand), var(--brand2))}
    .dotDone{background:rgba(34,197,94,.65)}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace}
  </style>
</head>
<body>
  <header class="brandBar">
    <div class="brandInner" style="justify-content:flex-end">
      <a class="btn igBtn igLink" href="https://www.instagram.com/bentoacaiteria/" target="_blank" rel="noopener">
        <span class="igIcon" aria-hidden="true">
          <svg viewBox="0 0 24 24" width="18" height="18" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M7.5 2h9A5.5 5.5 0 0 1 22 7.5v9A5.5 5.5 0 0 1 16.5 22h-9A5.5 5.5 0 0 1 2 16.5v-9A5.5 5.5 0 0 1 7.5 2Z" stroke="currentColor" stroke-width="1.8"/>
            <path d="M12 16.2a4.2 4.2 0 1 0 0-8.4 4.2 4.2 0 0 0 0 8.4Z" stroke="currentColor" stroke-width="1.8"/>
            <path d="M17.2 6.8h.01" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
          </svg>
        </span>
        <span>Instagram</span>
      </a>
    </div>
  </header>

  <div class="container">
    <div class="cartPanel" style="margin-top:24px">
      <h2 style="margin-top:0">✅ Pagamento aprovado</h2>
      <p class="muted">
        Seu pedido foi criado e entrou em produção. Acompanhe abaixo.
      </p>

      <div class="hr"></div>

      <div class="trackGrid">
        <div class="step">
          <div class="stepTitle">
            <div style="display:flex;align-items:center;gap:10px">
              <span id="dotProd" class="dot dotActive"></span>
              <strong>Produção</strong>
            </div>
            <span class="badge" id="timeProd">—</span>
          </div>
          <div class="muted" style="margin-top:8px">
            Preparando seu pedido. Tempo estimado: <b>25 min</b>.
          </div>
        </div>

        <div class="step">
          <div class="stepTitle">
            <div style="display:flex;align-items:center;gap:10px">
              <span id="dotOut" class="dot"></span>
              <strong>Saiu para entrega</strong>
            </div>
            <span class="badge" id="timeOut">—</span>
          </div>
          <div class="muted" style="margin-top:8px">
            A caminho. Após <b>10 min</b>, este fluxo de teste exibirá cancelamento e estorno automático.
          </div>
        </div>
      </div>

      <div style="margin-top:12px" class="step">
        <div class="stepTitle">
          <div style="display:flex;align-items:center;gap:10px">
            <span id="dotCancel" class="dot"></span>
            <strong>Status do pedido</strong>
          </div>
          <span class="badge mono" id="orderId">—</span>
        </div>
        <div class="muted" style="margin-top:8px" id="statusText">
          —
        </div>
      </div>

      <div class="hr"></div>

      <div style="display:flex; gap:10px; margin-top:12px; flex-wrap:wrap">
        <a class="btn btnPrimary" href="./index.html" style="justify-content:center">Fazer novo pedido</a>
        <a class="btn" href="./checkout.html">Voltar ao checkout</a>
      </div>

      <div class="footer">
        Observação: este acompanhamento é um <b>fluxo automático de demonstração</b>. Quando você ligar o backend real,
        basta atualizar os status conforme seu painel/kitchen display.
      </div>
    </div>
  </div>

  <script>
    const ORDER_KEY = "bento_last_order_v1";

    function fmtMs(ms){
      if(ms <= 0) return "00:00";
      const s = Math.floor(ms/1000);
      const m = Math.floor(s/60);
      const r = s % 60;
      return String(m).padStart(2,"0") + ":" + String(r).padStart(2,"0");
    }

    function loadOrder(){
      try{ return JSON.parse(localStorage.getItem(ORDER_KEY) || "null"); }catch(e){ return null; }
    }

    function setDots(stage){
      const prod = document.getElementById("dotProd");
      const out = document.getElementById("dotOut");
      const cancel = document.getElementById("dotCancel");

      // reset
      [prod,out,cancel].forEach(d=>d.className="dot");

      if(stage === "produção"){
        prod.classList.add("dotActive");
      } else if(stage === "saiu_para_entrega"){
        prod.classList.add("dotDone");
        out.classList.add("dotActive");
      } else if(stage === "cancelado"){
        prod.classList.add("dotDone");
        out.classList.add("dotDone");
        cancel.classList.add("dotActive");
      }
    }

    function render(){
      const order = loadOrder();
      const statusText = document.getElementById("statusText");
      const orderId = document.getElementById("orderId");
      const timeProd = document.getElementById("timeProd");
      const timeOut = document.getElementById("timeOut");

      if(!order){
        orderId.textContent = "SEM PEDIDO";
        statusText.textContent = "Não encontrei pedido salvo. Volte ao checkout e finalize novamente.";
        setDots("produção");
        timeProd.textContent = "—";
        timeOut.textContent = "—";
        return;
      }

      orderId.textContent = order.id || "—";

      const now = Date.now();
      const tProdEnd = order.createdAt + 25*60*1000;
      const tOutEnd = order.createdAt + 35*60*1000;

      let stage = "produção";
      if(now >= tProdEnd) stage = "saiu_para_entrega";
      if(now >= tOutEnd) stage = "cancelado";

      setDots(stage);

      // countdown labels
      timeProd.textContent = now < tProdEnd ? `⏳ ${fmtMs(tProdEnd-now)}` : "✅ concluído";
      timeOut.textContent = now < tOutEnd ? (now < tProdEnd ? "aguardando" : `⏳ ${fmtMs(tOutEnd-now)}`) : "⚠️ encerrado";

      if(stage === "produção"){
        statusText.innerHTML = `Status: <b>Em produção</b>. Previsão de saída: <b>${new Date(tProdEnd).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})}</b>.`;
      } else if(stage === "saiu_para_entrega"){
        statusText.innerHTML = `Status: <b>Saiu para entrega</b>. Se este fosse o fluxo real, aqui você exibiria rastreio/entregador.`;
      } else {
        statusText.innerHTML = `Status: <b>Pedido cancelado</b>. O estorno será feito <b>de forma automática</b>. Se precisar, entre em contato com o suporte.`;
      }
    }

    render();
    setInterval(render, 1000);
  </script>
  <script src="./brand.js"></script>
</body>
</html>